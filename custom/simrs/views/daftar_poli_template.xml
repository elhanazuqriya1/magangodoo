<odoo>
    <template id="daftar_poli_template" name="Formulir Pendaftaran Poli">
        <t t-call="website.layout">
            <div class="container mt-5 mb-5">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card shadow-lg p-4 rounded">
                            <h2 class="mb-4 text-center">Formulir Pendaftaran Poli</h2>
                           <form action="/pendaftaranpoli/sukses" method="post">
                              <div class="form-group mb-3">
                                    <label for="pasien_id">Pasien</label>
                                    <select name="pasien_id" required="1" class="form-control" id="pasienSelect">
                                        <option value="">-- Pilih Pasien --</option>
                                        <t t-foreach="pasien_list" t-as="pasien">
                                            <option t-att="{'value': pasien.id, 'data-norm': pasien.no_rm}">
                                                <t t-esc="pasien.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>
                                
                                <div class="form-group mb-3">
                                    <label for="no_rm">No RM</label>
                                    <input type="text" id="noRmField" name="no_rm" class="form-control" readonly="1"/>
                                </div>

                                <div class="form-group mb-3">
                                    <label for="unit_id">Poli/Unit</label>
                                    <select name="unit_id" required="1" class="form-control" id="unitSelect">
                                        <t t-foreach="unit_list" t-as="unit">
                                            <option t-att-value="unit.id"><t t-esc="unit.name"/></option>
                                        </t>
                                    </select>
                                </div>

                                <div class="form-group mb-3">
                                    <label for="dokter_id">Dokter</label>
                                    <select name="dokter_id" required="1" class="form-control" id="dokterSelect">
                                        <option value="">-- Pilih Dokter --</option>
                                        <!-- Diisi secara dinamis oleh JavaScript -->
                                    </select>
                                </div>

                                <div class="form-group mb-3">
                                    <label for="tanggal">Tanggal</label>
                                    <input type="date" name="tanggal" class="form-control" required="1" t-att-value="default_date"/>
                                </div>

                                <button type="submit" class="btn btn-primary w-100">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JavaScript -->
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function () {
                    const pasienSelect = document.getElementById('pasienSelect');
                    const noRmField = document.getElementById('noRmField');
                    const unitSelect = document.getElementById('unitSelect');
                    const dokterSelect = document.getElementById('dokterSelect');

                    // Tampilkan No RM otomatis
                    pasienSelect.addEventListener('change', function () {
                        const selectedOption = pasienSelect.options[pasienSelect.selectedIndex];
                        noRmField.value = selectedOption.getAttribute('data-norm');
                    });

                    // Load dokter ketika unit dipilih
                    unitSelect.addEventListener('change', function () {
                        const unitId = unitSelect.value;
                        fetch(`/get_dokter_by_unit/${unitId}`)
                            .then(response => response.json())
                            .then(data => {
                                dokterSelect.innerHTML = ''; // Bersihkan dulu
                                if (data.length === 0) {
                                    dokterSelect.innerHTML = '<option value="">(Tidak ada dokter)</option>';
                                } else {
                                    data.forEach(function (dokter) {
                                        const opt = document.createElement('option');
                                        opt.value = dokter.id;
                                        opt.textContent = dokter.name;
                                        dokterSelect.appendChild(opt);
                                    });
                                }
                            });
                    });

                    // Inisialisasi No RM saat load
                    const selectedPasien = pasienSelect.options[pasienSelect.selectedIndex];
                    if (selectedPasien) {
                        noRmField.value = selectedPasien.getAttribute('data-norm');
                    }
                });
            </script>
        </t>
    </template>
</odoo>